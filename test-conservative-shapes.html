<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conservative Shape Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { margin: 5px 0; padding: 5px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Conservative Shape Test</h1>
    <div id="logs"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="shape-storage.js"></script>
    <script src="practice-mode-manager.js"></script>

    <script>
        const logs = document.getElementById('logs');
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
            logs.appendChild(div);
            console.log(msg);
        }

        async function testConservativeShapes() {
            try {
                log('üß™ Testing conservative practice mode...', 'info');

                // Create practice manager
                const practiceManager = new PracticeModeManager();
                log('‚úÖ PracticeModeManager created', 'success');

                // Initialize
                log('üîÑ Initializing practice mode...', 'info');
                const initResult = await practiceManager.initialize();

                if (initResult.success) {
                    log('‚úÖ Practice mode initialized successfully', 'success');

                    const navInfo = practiceManager.getNavigationInfo();
                    if (navInfo) {
                        log(`üìÖ Current shape: ${navInfo.currentShapeName}`, 'success');
                        log(`üìä Navigation: prev=${navInfo.hasPrevious}, next=${navInfo.hasNext}`, 'info');
                    }

                    // Test navigation
                    log('üîÑ Testing navigation...', 'info');

                    // Try next shape
                    const nextShape = await practiceManager.nextShape();
                    if (nextShape) {
                        log('‚úÖ Next shape loaded successfully', 'success');
                        const nextNavInfo = practiceManager.getNavigationInfo();
                        log(`üìÖ Next shape: ${nextNavInfo.currentShapeName}`, 'info');
                    } else {
                        log('‚ÑπÔ∏è No next shape available (expected)', 'info');
                    }

                    // Try previous shape
                    const prevShape = await practiceManager.previousShape();
                    if (prevShape) {
                        log('‚úÖ Previous shape loaded successfully', 'success');
                        const prevNavInfo = practiceManager.getNavigationInfo();
                        log(`üìÖ Previous shape: ${prevNavInfo.currentShapeName}`, 'info');
                    } else {
                        log('‚ÑπÔ∏è No previous shape available', 'info');
                    }

                    // Test random shape
                    const randomShape = await practiceManager.randomShape();
                    if (randomShape) {
                        log('‚úÖ Random shape loaded successfully', 'success');
                        const randomNavInfo = practiceManager.getNavigationInfo();
                        log(`üìÖ Random shape: ${randomNavInfo.currentShapeName}`, 'info');
                    } else {
                        log('‚ÑπÔ∏è No random shape available', 'info');
                    }

                } else {
                    log('‚ùå Practice mode initialization failed', 'error');
                }

            } catch (error) {
                log(`‚ùå Test failed: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // Wait for scripts to load
        setTimeout(testConservativeShapes, 1000);
    </script>
</body>
</html>