<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Integration Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { margin: 5px 0; padding: 5px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Practice Integration Test</h1>
    <div id="logs"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="shape-storage.js"></script>
    <script src="practice-mode-manager.js"></script>
    <script src="daily-mode-manager.js"></script>
    <script src="game-mode-integration.js"></script>

    <script>
        const logs = document.getElementById('logs');
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
            logs.appendChild(div);
            console.log(msg);
        }

        async function testIntegration() {
            try {
                log('üß™ Testing GameModeIntegration...', 'info');

                // Test if classes are available
                if (!window.GameModeIntegration) {
                    log('‚ùå GameModeIntegration class not found', 'error');
                    return;
                }
                log('‚úÖ GameModeIntegration class found', 'success');

                // Create instance
                const integration = new GameModeIntegration();
                log('‚úÖ GameModeIntegration instance created', 'success');

                // Initialize
                const result = await integration.initialize();
                log(`üìã Initialization result: ${result}`, result ? 'success' : 'error');

                // Check daily mode
                if (integration.dailyMode) {
                    log('‚úÖ Daily mode available', 'success');
                } else {
                    log('‚ùå Daily mode not available', 'error');
                }

                // Check practice mode
                if (integration.practiceMode) {
                    log('‚úÖ Practice mode available', 'success');
                } else {
                    log('‚ö†Ô∏è Practice mode not initialized, testing manual initialization...', 'info');

                    // Try to initialize practice mode manually
                    await integration.initializePracticeMode();

                    if (integration.practiceMode) {
                        log('‚úÖ Practice mode manually initialized', 'success');

                        // Test getting available dates
                        const navInfo = integration.practiceMode.getNavigationInfo();
                        if (navInfo) {
                            log(`üìÖ Current practice date: ${navInfo.currentDate}`, 'success');
                            log(`üìä Total available dates: ${navInfo.totalDates}`, 'info');
                        }

                        // Test getting available dates list
                        const datesList = integration.practiceMode.getAvailableDatesList();
                        if (datesList && datesList.length > 0) {
                            log(`üìã Available dates: ${datesList.length}`, 'success');
                            log(`üìç First date: ${datesList[0].date}`, 'info');
                            if (datesList[0].isTwoDaysAgo) {
                                log('‚úÖ Correctly starts from two days ago', 'success');
                            } else {
                                log('‚ùå Does not start from two days ago', 'error');
                            }
                        }
                    } else {
                        log('‚ùå Failed to initialize practice mode', 'error');
                    }
                }

                // Expose globally like the real system does
                window.gameModeIntegration = integration;
                log('‚úÖ Exposed as window.gameModeIntegration', 'success');

                // Test what practice-mode.js would see
                log('üîç Testing practice-mode.js detection logic...', 'info');
                if (window.gameModeIntegration) {
                    log('‚úÖ window.gameModeIntegration exists', 'success');

                    if (window.gameModeIntegration.practiceMode) {
                        log('‚úÖ window.gameModeIntegration.practiceMode exists', 'success');
                    } else {
                        log('‚ùå window.gameModeIntegration.practiceMode missing', 'error');
                    }
                } else {
                    log('‚ùå window.gameModeIntegration missing', 'error');
                }

            } catch (error) {
                log(`‚ùå Test failed: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // Wait a moment for scripts to load
        setTimeout(testIntegration, 1000);
    </script>
</body>
</html>